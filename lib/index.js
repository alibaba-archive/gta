// Generated by CoffeeScript 1.6.3
(function() {
  var Gta, exports,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  exports = exports || this;

  Gta = (function() {
    function Gta(options) {
      var Provider, option, provider;
      this.options = options;
      this.providers = {};
      for (provider in options) {
        option = options[provider];
        Provider = Gta["" + (provider[0].toUpperCase()) + provider.slice(1)];
        if (Provider != null) {
          this.providers[provider] = new Provider(option);
        }
      }
      if (window.jQuery) {
        this.delegateEvents();
      }
    }

    Gta.prototype.pageview = function() {
      var name, provider, _ref;
      _ref = this.providers;
      for (name in _ref) {
        provider = _ref[name];
        provider.pageview.apply(provider, arguments);
      }
      return this;
    };

    Gta.prototype.event = function() {
      var name, provider, _ref;
      _ref = this.providers;
      for (name in _ref) {
        provider = _ref[name];
        provider.event.apply(provider, arguments);
      }
      return this;
    };

    Gta.prototype.delegateEvents = function() {
      var _this = this;
      return $(document).on('click.gta', '[data-gta="event"]', function(e) {
        var $target, action, category, label, value;
        $target = $(e.currentTarget);
        category = $target.data('category') || $target[0].tagName;
        label = $target.data('label') || $target[0].className;
        action = $target.data('action') || e.type;
        value = $target.data('value') || $target.html();
        return _this.event(category, action, label, value);
      });
    };

    Gta.appendScript = function(script) {
      var dom, head, text;
      dom = document.createElement('script');
      text = document.createTextNode(script);
      dom.appendChild(text);
      head = document.getElementsByTagName('head')[0];
      return head.appendChild(dom);
    };

    Gta.Base = (function() {
      function Base(option) {
        this.option = option;
        this.option.account = option.account || '';
        this._initial();
      }

      return Base;

    })();

    Gta.Google = (function(_super) {
      __extends(Google, _super);

      function Google(option) {
        Google.__super__.constructor.apply(this, arguments);
      }

      Google.prototype._initial = function() {
        if (window.ga == null) {
          Gta.appendScript("(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\nm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\nga('create', '" + this.option.account + "');\nga('send', 'pageview');");
        }
        return window.ga;
      };

      Google.prototype.pageview = function() {
        var args, data, i, val;
        args = (function() {
          var _results;
          _results = [];
          for (i in arguments) {
            val = arguments[i];
            _results.push(val);
          }
          return _results;
        }).apply(this, arguments);
        data = typeof args[0] === 'object' ? args[0] : args.join('_');
        return typeof window.ga === "function" ? window.ga('send', 'pageview', data) : void 0;
      };

      Google.prototype.event = function() {
        var args, i, val;
        args = (function() {
          var _results;
          _results = [];
          for (i in arguments) {
            val = arguments[i];
            _results.push(val);
          }
          return _results;
        }).apply(this, arguments);
        return typeof window.ga === "function" ? window.ga('send', 'events', args) : void 0;
      };

      return Google;

    })(Gta.Base);

    Gta.Baidu = (function(_super) {
      __extends(Baidu, _super);

      function Baidu(option) {
        Baidu.__super__.constructor.apply(this, arguments);
      }

      Baidu.prototype._initial = function() {
        if (window._hmt == null) {
          Gta.appendScript("var _hmt = _hmt || [];\n(function() {\n  var hm = document.createElement(\"script\");\n  hm.src = \"//hm.baidu.com/hm.js?" + this.option.account + "\";\n  var s = document.getElementsByTagName(\"script\")[0];\n  s.parentNode.insertBefore(hm, s);\n})();");
        }
        return window._hmt;
      };

      Baidu.prototype.pageview = function() {
        var args, data, i, v, val, _ref;
        args = (function() {
          var _results;
          _results = [];
          for (i in arguments) {
            val = arguments[i];
            _results.push(val);
          }
          return _results;
        }).apply(this, arguments);
        if (typeof args[0] === 'object') {
          if (args[0]['page'] != null) {
            data = args[0]['page'];
          } else {
            data = (function() {
              var _ref, _results;
              _ref = args[0];
              _results = [];
              for (i in _ref) {
                v = _ref[i];
                _results.push(v);
              }
              return _results;
            })();
            data = data.join('_');
          }
        } else {
          data = args.join('_');
        }
        return (_ref = window._hmt) != null ? _ref.push(['_trackPageview', data]) : void 0;
      };

      Baidu.prototype.event = function() {
        var args, data, i, val, _ref;
        args = (function() {
          var _results;
          _results = [];
          for (i in arguments) {
            val = arguments[i];
            _results.push(val);
          }
          return _results;
        }).apply(this, arguments);
        data = ['_trackEvent'].concat(args);
        return (_ref = window._hmt) != null ? _ref.push(data) : void 0;
      };

      return Baidu;

    })(Gta.Base);

    Gta.Mixpanel = (function(_super) {
      __extends(Mixpanel, _super);

      function Mixpanel(options) {
        Mixpanel.__super__.constructor.apply(this, arguments);
      }

      Mixpanel.prototype._initial = function() {
        if (!window.Mixpanel) {
          Gta.appendScript("(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement('script');a.type='text/javascript';a.async=!0;a.src=('https:'===e.location.protocol?'https:':'http:')+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName('script')[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split('.');2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;'undefined'!==\ntypeof d?c=b[d]=[]:d='mixpanel';c.people=c.people||[];c.toString=function(b){var a='mixpanel';'mixpanel'!==d&&(a+='.'+d);b||(a+=' (stub)');return a};c.people.toString=function(){return c.toString(1)+'.people (stub)'};i='disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user'.split(' ');for(g=0;g<i.length;g++)f(c,i[g]);\nb._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);\nmixpanel.init('" + this.option.account + "');");
        }
        return window.mixpanel;
      };

      Mixpanel.prototype.pageview = function() {};

      Mixpanel.prototype.event = function() {
        return mixpanel.track(arguments[3]);
      };

      return Mixpanel;

    })(Gta.Base);

    return Gta;

  })();

  exports.Gta = Gta;

}).call(this);
